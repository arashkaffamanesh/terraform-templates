{  
    "$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion":"1.0.0.0",
    "parameters":{  
       "ssh_key":{  
          "type":"string"
       },
       "admin_username":{  
          "type":"string"
       },
       "osdisk_size":{  
          "type": "int",
          "defaultValue": 0
       },
       "agentpool_count":{  
        "type": "int",
        "defaultValue": 3
       },
       "vnet_subid":{  
          "type":"string"
       },
       "max_pods":{  
          "type":"int"
       },
       "network_plugin":{  
          "type":"string"
       },
       "serviceCidr":{  
        "type": "string"
       },
       "dnsServiceIP":{  
          "type":"string"
       },
       "dockerBridgeCidr":{  
          "type":"string"
       },
       "vm_size":{  
          "type":"string"
       },
       "agentpool_name":{  
          "type":"string"
       },
       "dns_prefix":{  
          "type":"string"
       },
       "kubernetes_version":{  
          "type":"string"
       },
       "name":{  
          "type":"string"
       },
       "clientapp_id":{  
          "type":"string"
       },
       "serverapp_id":{  
          "type":"string"
       },
       "serverapp_secret":{  
          "type":"string"
       },
       "tenant_id":{  
          "type":"string"
       },
       "sp_secret":{  
          "type":"string"
       },
       "sp_clientid":{  
          "type":"string"
       },
       "location":{  
          "type":"string",
          "defaultValue":"[resourceGroup().location]",
          "metadata":{  
             "description":"Location for all resources."
          }
       }
    },
    "resources":[  
       {  
          "name":"[parameters('name')]",
          "type":"Microsoft.ContainerService/managedClusters",
          "apiVersion":"2018-03-31",
          "location":"[parameters('location')]",
          "tags":{  
 
          },
          "properties":{  
             "kubernetesVersion":"[parameters('kubernetes_version')]",
             "dnsPrefix":"[parameters('dns_prefix')]",
             "agentPoolProfiles":[  
                {  
                   "name": "agentpool",
                   "count":"[parameters('agentpool_count')]",
                   "vmSize":"[parameters('vm_size')]",
                   "osDiskSizeGB":"[parameters('osdisk_size')]",
                   "vnetSubnetID":"[parameters('vnet_subid')]",
                   "maxPods":"[parameters('max_pods')]",
                   "osType":"Linux",
                   "storageProfile": "ManagedDisks"
                }
             ],
             "linuxProfile":{  
                "adminUsername":"[parameters('admin_username')]",
                "ssh":{  
                   "publicKeys":[  
                      {  
                         "keyData":"[parameters('ssh_key')]"
                      }
                   ]
                }
             },
             "servicePrincipalProfile":{  
                "clientId":"[parameters('sp_clientid')]",
                "secret":"[parameters('sp_secret')]"
             },
             "addonProfiles":{  
 
             },
             "enableRBAC":true,
             "networkProfile":{  
                "networkPlugin":"[parameters('network_plugin')]",
                "serviceCidr":"[parameters('serviceCidr')]",
                "dnsServiceIP":"[parameters('dnsServiceIP')]",
                "dockerBridgeCidr":"[parameters('dockerBridgeCidr')]"
             },
             "aadProfile":{  
                "clientAppID":"[parameters('clientapp_id')]",
                "serverAppID":"[parameters('serverapp_id')]",
                "serverAppSecret":"[parameters('serverapp_secret')]",
                "tenantID":"[parameters('tenant_id')]"
             }
          }
       }
    ]
 }